<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sureway Logistics - Blockchain Supply Chain Platform</title>
    <style>
        /* YOUR EXISTING CSS STYLES - KEEP ALL OF THIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* ... ALL YOUR EXISTING CSS ... */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@stacks/connect@6.7.4/dist/connect.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="nav-container">
            <div class="logo">
                <div class="logo-img">
                    <img src="sureway-logo.png" alt="Sureway Logistics" 
                         style="width: 100%; height: 100%; border-radius: 10px; object-fit: cover;">
                </div>
                <div class="logo-text">Sureway Logistics</div>
            </div>
            <ul class="nav-links">
                <li><a href="#" onclick="showDashboard()">Dashboard</a></li>
                <li><a href="#" onclick="showAbout()">About</a></li>
                <li><a href="#" onclick="showContact()">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h1>Blockchain-Powered Logistics Platform</h1>
            <p>Secure, transparent supply chain management with Stacks blockchain</p>
            
            <!-- Wallet Section -->
            <div class="wallet-section">
                <h3>🔗 Stacks Blockchain Wallet</h3>
                
                <div class="wallet-status">
                    <div class="status-dot"></div>
                    <span id="status-text">🔴 Disconnected</span>
                </div>

                <!-- ADD THE MISSING WALLET BUTTONS AND INFO -->
                <div class="wallet-buttons">
                    <button class="wallet-btn connect-btn" onclick="connectWallet()">
                        🔗 Connect Leather Wallet
                    </button>
                    <button class="wallet-btn disconnect-btn" onclick="disconnectWallet()">
                        🚪 Disconnect
                    </button>
                </div>

                <button class="wallet-btn" onclick="showMobileHelp()" 
                        style="background: rgba(255,255,255,0.2); color: white; margin-bottom: 1rem;">
                    📱 Mobile Help
                </button>

                <!-- Wallet Info Display -->
                <div class="wallet-info" id="wallet-info">
                    <div><strong>Address:</strong> <span id="user-address">-</span></div>
                    <div><strong>Balance:</strong> <span id="user-balance">-</span> STX</div>
                    <div><strong>Network:</strong> <span id="user-network">-</span></div>
                    
                    <button class="btn btn-primary" onclick="testRealTransaction()" 
                            style="margin-top: 1rem; width: 100%;">
                        🧪 Test Real Transaction
                    </button>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section class="dashboard">
            <h2>📦 Shipment Management</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('create')">Create Shipment</button>
                <button class="tab" onclick="switchTab('active')">Active Shipments</button>
                <button class="tab" onclick="switchTab('completed')">Completed</button>
            </div>

            <!-- Tab Contents -->
            <div id="create-tab" class="tab-content active">
                <div class="form-group">
                    <label>Origin</label>
                    <input type="text" id="origin" placeholder="e.g., Lagos, Nigeria">
                </div>
                <div class="form-group">
                    <label>Destination</label>
                    <input type="text" id="destination" placeholder="e.g., Accra, Ghana">
                </div>
                <div class="form-group">
                    <label>Cargo Value (STX)</label>
                    <input type="number" id="cargo-value" placeholder="e.g., 100">
                </div>
                <button class="btn btn-primary" onclick="createShipment()">Create Shipment</button>
            </div>

            <div id="active-tab" class="tab-content">
                <p>Active shipments will appear here once created.</p>
            </div>

            <div id="completed-tab" class="tab-content">
                <p>Completed shipments will appear here.</p>
            </div>
        </section>
    </div>

    <!-- Notification System -->
    <div id="notification" class="notification">
        <span id="notification-text"></span>
    </div>

    <!-- ===== PASTE THE JAVASCRIPT CODE RIGHT HERE ===== -->
    <script>
    // ===== WORKING MOBILE WALLET INTEGRATION =====
    async function connectWallet() {
        try {
            showNotification('🔗 Connecting to Leather Wallet...', 'info');

            // Check if Stacks Connect is available
            if (typeof window.StacksConnect !== 'undefined') {
                await connectWithStacksConnect();
            } 
            // Check for Leather extension
            else if (typeof window.LeatherProvider !== 'undefined') {
                await connectWithLeatherExtension();
            }
            // Mobile-specific deep linking
            else if (isMobileDevice()) {
                await connectWithMobileDeepLink();
            }
            else {
                showNotification('❌ No wallet detected. Please install Leather Wallet', 'error');
                simulateWalletConnection();
            }
            
        } catch (error) {
            console.error('Wallet connection error:', error);
            showNotification('❌ Connection failed - using demo mode', 'error');
            simulateWalletConnection();
        }
    }

    // === STACKS CONNECT INTEGRATION ===
    async function connectWithStacksConnect() {
        try {
            const appDetails = {
                name: 'Sureway Logistics',
                icon: window.location.origin + '/logo.png'
            };

            const connect = window.StacksConnect;
            const userSession = new connect.UserSession({ appDetails });
            
            if (userSession.isUserSignedIn()) {
                const userData = userSession.loadUserData();
                await handleRealWalletConnection(userData.profile.stxAddress.testnet);
            } else {
                userSession.redirectToSignIn();
            }
        } catch (error) {
            throw new Error('Stacks Connect failed: ' + error.message);
        }
    }

    // === LEATHER EXTENSION INTEGRATION ===
    async function connectWithLeatherExtension() {
        try {
            const provider = new window.LeatherProvider();
            const accounts = await provider.getAccounts();
            
            if (accounts.length === 0) {
                throw new Error('No accounts found');
            }
            
            const userAddress = accounts[0];
            await handleRealWalletConnection(userAddress);
        } catch (error) {
            throw new Error('Leather extension failed: ' + error.message);
        }
    }

    // === MOBILE DEEP LINK INTEGRATION ===
    async function connectWithMobileDeepLink() {
        showNotification('📱 Opening Leather Wallet App...', 'info');
        
        const authRequest = `stacks:?action=connect&redirect_uri=${encodeURIComponent(window.location.href)}&appName=Sureway+Logistics`;
        window.location.href = authRequest;
        
        setTimeout(() => {
            if (!document.hidden) {
                showNotification('💡 Make sure Leather Wallet is installed!', 'info');
                simulateWalletConnection();
            }
        }, 3000);
    }

    // === MOBILE DETECTION ===
    function isMobileDevice() {
        return /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);
    }

    // === REAL CONNECTION HANDLER ===
    async function handleRealWalletConnection(address) {
        document.getElementById('status-text').textContent = '🟢 Connected';
        document.querySelector('.status-dot').style.background = '#00d4aa';
        document.getElementById('wallet-info').style.display = 'block';
        document.getElementById('user-address').textContent = `${address.slice(0, 8)}...${address.slice(-8)}`;
        document.getElementById('user-network').textContent = 'Testnet';
        
        await fetchRealBalance(address);
        showNotification('✅ Leather Wallet Connected Successfully!', 'success');
    }

    // === REAL BALANCE FETCH ===
    async function fetchRealBalance(address) {
        try {
            const response = await fetch(`https://api.testnet.hiro.so/extended/v1/address/${address}/stx`);
            const data = await response.json();
            
            const balance = (data.balance / 1000000).toFixed(2);
            document.getElementById('user-balance').textContent = balance;
            
            showNotification(`💰 Balance: ${balance} STX`, 'success');
        } catch (error) {
            console.error('Balance fetch error:', error);
            document.getElementById('user-balance').textContent = '0.00';
            showNotification('⚠️ Could not fetch balance', 'info');
        }
    }

    // === DEMO FALLBACK ===
    function simulateWalletConnection() {
        showNotification('🔗 Setting up demo mode...', 'info');
        
        setTimeout(() => {
            document.getElementById('status-text').textContent = '🟢 Connected (Demo)';
            document.querySelector('.status-dot').style.background = '#00d4aa';
            document.getElementById('wallet-info').style.display = 'block';
            document.getElementById('user-address').textContent = 'ST3XE7...Q7WA';
            document.getElementById('user-balance').textContent = '500.00';
            document.getElementById('user-network').textContent = 'Testnet (Demo)';
            
            showNotification('✅ Demo wallet connected!', 'success');
        }, 1500);
    }

    // === DISCONNECT WALLET ===
    function disconnectWallet() {
        document.getElementById('status-text').textContent = '🔴 Disconnected';
        document.querySelector('.status-dot').style.background = '#ff6b6b';
        document.getElementById('wallet-info').style.display = 'none';
        showNotification('👋 Wallet disconnected', 'info');
    }

    // === TEST TRANSACTION ===
    async function testRealTransaction() {
        const userAddress = document.getElementById('user-address').textContent;
        
        if (userAddress.includes('(Demo)') || userAddress === 'ST3XE7...Q7WA') {
            showNotification('❌ Please connect REAL wallet first', 'error');
            showMobileHelp();
            return;
        }
        
        showNotification('🚀 This would execute a real transaction!', 'success');
    }

    // === MOBILE HELP ===
    function showMobileHelp() {
        const helpText = `🎯 REAL MOBILE CONNECTION GUIDE:

1. ✅ REQUIRED: Install Leather Wallet Mobile App
2. 🔗 CONNECTION:
   • Open Leather Wallet App
   • Go to "Browser" tab  
   • Enter your website URL
   • Click "Connect Wallet"

3. 💰 EXPECTED RESULTS:
   • Should show YOUR real address (not ST3XE7...)
   • Should show YOUR real balance (not 500.00)
   • Status should NOT say "(Demo)"`;

        alert(helpText);
    }

    // === NOTIFICATION SYSTEM ===
    function showNotification(message, type) {
        const notification = document.getElementById('notification');
        const text = document.getElementById('notification-text');
        
        notification.className = `notification ${type}`;
        text.textContent = message;
        
        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => notification.classList.remove('show'), 5000);
    }

    // === DASHBOARD FUNCTIONS ===
    function showDashboard() {
        showNotification('🏠 Dashboard loaded successfully', 'info');
    }

    function showAbout() {
        showNotification('🚀 Sureway Logistics - Transforming African supply chains with blockchain technology', 'info');
    }

    function showContact() {
        showNotification('📞 Contact us: sureway@logistics.com • +234 XXX XXX XXXX', 'info');
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    function createShipment() {
        const origin = document.getElementById('origin').value;
        const destination = document.getElementById('destination').value;
        const value = document.getElementById('cargo-value').value;
        
        if (!origin || !destination || !value) {
            showNotification('❌ Please fill all fields', 'error');
            return;
        }
        
        showNotification(`✅ Shipment created: ${origin} → ${destination} (${value} STX)`, 'success');
        document.getElementById('origin').value = '';
        document.getElementById('destination').value = '';
        document.getElementById('cargo-value').value = '';
    }

    // === INITIALIZE ===
    document.addEventListener('DOMContentLoaded', function() {
        showNotification('Welcome to Sureway Logistics! Connect your Leather Wallet.', 'info');
        
        if (typeof window.StacksConnect !== 'undefined' || typeof window.LeatherProvider !== 'undefined') {
            showNotification('👛 Wallet detected! Click "Connect Wallet"', 'info');
        }
    });
    </script>
</body>
</html>
